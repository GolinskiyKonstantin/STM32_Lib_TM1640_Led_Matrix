/*	сохраняем данный файл в кодировке UTF-8		*/


/////////////////////////////////////////////////////////////////////
// подключение:
//***********   настройки портов DIN CLK ***************************************************************

		// управление по двум портам ( настроины как выход без подтяжки )
		// для работы всеголиш меняем на портах логические уровни
		// используем библиотеку HAL, если не через HAL то перепределяем

		//=== указываем порты ( если в кубе назвали их DIN CLK то тогда нечего указывать не нужно )
		#if defined (DIN_GPIO_Port)
		#else
			#define DIN_GPIO_Port	GPIOC
			#define DIN_Pin			GPIO_PIN_5
		#endif
		
		#if defined (CLK_GPIO_Port)
		#else
			#define CLK_GPIO_Port   GPIOB
			#define CLK_Pin			GPIO_PIN_14
		#endif
		//========================================================================================
		
		#define SIZE_MATRIX_COL		16		// указываем кол-во колонок в матрице ( у нас 16 колонок )
//********************************************************************************************************




//////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "TM1640.h"
#include "animacion.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////////////


main()=============================================================================================================================

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	uint8_t flag = 0;							// флаг чтоб поочереди было сперва бегущая строка после анимация и покругу
	
	TM1640_brightness(1);								// устанавливаем подсветка значение от 0 до 7
	TM1640_clearDisplay();
	// TM1640_display_byte(15,0xF0);					// прорисовываем ( если нужно ) в последней строке 1 байт ( 0xF0 = получаем 11110000 )


	char *myText = "Привет Мир 12345 Hello Jon QWERTY";
	
	// указываем кол-во символов с учетом что кириллица 2 байта ,а латиница 1 байт( для латиницы подойдет strlen(myText) )
	int len = strlenUTF8(myText);
					
	// ТОЛЬКО для отображения анимации------------------------------------------------------
	// x = ( 8*MATRIXS_QUANTITY );	// ставим для движения анимации с права на лево
	// x = 0; // для движения анимации с лево на право
	//---------------------------------------------------------------------------------------
		
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
	
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	  
	
		// вывод бегущей строки
		if( !flag){
			
			TM1640_drawString_buff( myText, x, 0 );			// выводим на экран наш текст	  
			TM1640_display_Draw();							// отображаем на дисплее то что нарисовали выше
			
			HAL_Delay(100);									// задержка ( регулирует скорость прокрутки )

			if( --x < (len+1) * -8 ) {
				x = (SIZE_MATRIX_COL);
				flag=1;
			}
		}					  
					
//*************************************************************************	
		// вывод анимации
		else{					
					
			clear_buff();
			drawSprite( (uint8_t*)&a, x--, 0, 8, 8 ); 	// Х-- ставим для движения анимации с права на лево, Х++ для движения анимации с лево на право
			TM1640_display_Draw();						// отображаем на дисплее то что нарисовали выше
			
			HAL_Delay(200);

			clear_buff();
			drawSprite( (uint8_t*)&b, x--, 0, 8, 8 );	// Х-- ставим для движения анимации с права на лево, Х++ для движения анимации с лево на право
			TM1640_display_Draw();						// отображаем на дисплее то что нарисовали выше
			
			HAL_Delay(200);
					
			// внимание выводим столько кадров сколько есть в массиве ( в данном случае два кадра )
				
			//-- для движения анимации с лево на право -----------
			//	if( x > ( SIZE_MATRIX_COL ) ){
			//		x= -1;
			//	}
			//-----------------------------------------------------------

			//-----------------------------------------------------------	  
			//-- для движения анимации с права на лево -------------
				if( x <-6){
					x= ( SIZE_MATRIX_COL );
					flag=0;
				}
			//---------------------------------------------				
		}	

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////				


=== end while(1) ==================================================================================================================
=== end main() ====================================================================================================================
